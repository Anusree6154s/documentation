<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Content Manager</title>
    <script>
      window.CMS_MANUAL_INIT = true;
    </script>
  </head>
  <body>
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>

    <script>
      window.addEventListener("message", async (e) => {
        const { code, state } = e.data || {};
        console.log("ðŸ“© Message received from popup:", e.data);
        if (code) {
          console.log("ðŸš€ ~ window.addEventListener ~ code:", code);
          const response = await fetch(
            `https://netlify-cms-github-oauth-bf5t.onrender.com/auth/callback?code=${code}&state=${state}`
          );
          const data = await response.json();
          if (data.token) {
            console.log(
              "ðŸš€ ~ window.addEventListener ~ data.token:",
              data.token
            );
            // Token obtained â€” now tell CMS about this token
            CMS.auth.login(data.token); // Or use CMS.api.login(data.token) depending on Netlify CMS version
            CMS.init();
          } else {
            console.error("OAuth callback failed", data);
          }
        }
      });
    </script>
  </body>
</html>
